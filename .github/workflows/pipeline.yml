name: CI - Pipeline de Pruebas Automatizadas

# Disparadores del pipeline
on:
  push:
    branches:
      - main  # Despliegue a Producción al hacer push a main
  pull_request:
    branches:
      - main  # Despliegue de Previsualización (Preview) en cada PR

jobs:
  ci_validation:
    name: CI - Instalación y Pruebas
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. Checkout del Código
        uses: actions/checkout@v4

      # 2. Configurar Python 3.11 (Se elimina el paso de Node.js)
      - name: 2. Configurar Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: 3. Instalar Dependencias de Python
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          pip install pytest

      - name: 4. Ejecutar Pruebas (Validación RF6)
        run: |
          echo "Buscando pruebas unitarias..."
          # Verifica si existe algún archivo de prueba con el patrón Pytest
          if git ls-files -- 'tests/**/test_*.py' 'test_*.py' | grep -q .; then
            echo "Tests encontrados. Ejecutando pytest..."
            # Ejecuta el comando simple, asumiendo que ya instaló Pytest
            pytest
          else
            echo "No se encontraron tests. Saltando pytest para permitir el despliegue (CD)."
          fi

      - name: 5. Construir el Proyecto (Opcional para Python Serverless)
        run: echo "Build de Python omitido/personalizado para Vercel."
        
      - name: Notify
        run: |
          echo "Pipeline completado. Resultado: $GITHUB_WORKFLOW"
